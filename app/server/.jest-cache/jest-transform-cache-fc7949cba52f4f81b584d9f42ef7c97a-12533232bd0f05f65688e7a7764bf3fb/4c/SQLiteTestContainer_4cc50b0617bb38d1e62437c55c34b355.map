{"file":"C:\\Users\\Joseph\\Desktop\\Source\\User_Management_App\\app\\server\\tests\\__configurations__\\SQLiteTestContainer.ts","mappings":";;;;;;AAAA,4BAA4B;AAC5B,4BAA0B,CAAC,sBAAsB;AACjD,mDAAwE;AACxE,qCAAwD;AACxD,gEAAsD;AACtD,uFAAwD;AACxD,4EAAkE;AAClE,uFAAwD;AACxD,iFAAkD;AAClD,qFAAsD;AACtD,iFAAkD;AAKlD,MAAM,OAAO,GAAsC;IACjD,IAAI,EAAE,QAAQ;IACd,QAAQ,EAAE,oCAAoC,EAAE,sDAAsD;IACtG,QAAQ,EAAE,CAAC,qBAAI,EAAE,qBAAI,EAAE,uBAAM,EAAE,8BAAU,EAAE,wBAAO,EAAE,wBAAO,EAAE,kBAAI,CAAC;IAClE,WAAW,EAAE,IAAI;IACjB,gCAAgC;IACjC,gDAAgD;IAG/C,SAAS,EAAE,CAAC,sCAAsC,CAAC;CACpD,CAAC;AAEF,MAAM,YAAY,GAAG,uBAAuB,CAAC,CAAC,4CAA4C;AAE1F,sDAAsD;AAEtD,MAAa,mBAAmB;IAAhC;QACU,oBAAe,GAAgC,IAAI,CAAC;QAG5C,0BAAqB,GAAG,KAAK,IAAI,EAAE;YACnD,MAAM,SAAS,GAAyB,MAAM,IAAI,iCAAgB,CAAC,YAAY,CAAC;iBAC7E,WAAW,CAAC,CAAC,MAAM,EAAE,IAAI,EAAE,WAAW,CAAC,CAAC,CAAC,2BAA2B;iBACpE,KAAK,EAAE,CAAC;YAGX,mDAAmD;YACnD,OAAO,EAAE,SAAS,EAAE,CAAC;QACvB,CAAC,CAAC;QAEO,uBAAkB,GAAI,KAAK,IAAG,EAAE;YACrC,OAAO,CAAC,GAAG,CAAC,mCAAmC,CAAC,CAAC;YACjD,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,qBAAqB,EAAE,CAAC;YACnD,IAAI,CAAC,eAAe,GAAG,OAAO,CAAC,SAAS,CAAC;YAGzC,IAAI,CAAC,UAAU,GAAG,IAAI,oBAAU,CAAC,OAAO,CAAC,CAAC;YAE1C,MAAM,IAAI,CAAC,UAAU,CAAC,UAAU,EAAE,CAAC;QAErC,CAAC,CAAA;QAEM,sBAAiB,GAAI,KAAK,IAAG,EAAE;YACpC,OAAO,CAAC,GAAG,CAAC,mCAAmC,CAAC,CAAC;YACjD,IAAI,IAAI,CAAC,UAAU,CAAC,aAAa,EAAC,CAAC;gBACjC,MAAM,IAAI,CAAC,UAAU,CAAC,OAAO,EAAE,CAAA;YACjC,CAAC;YAAA,CAAC;YACF,IAAI,IAAI,CAAC,eAAe,EAAC,CAAC;gBACxB,MAAM,IAAI,CAAC,eAAe,CAAC,IAAI,EAAE,CAAC;YACpC,CAAC;YAAA,CAAC;QACJ,CAAC,CAAA;QAEM,kBAAa,GAAE,GAAE,EAAE;YACxB,OAAO,IAAI,CAAC,UAAU,CAAC;QACzB,CAAC,CAAA;IAEH,CAAC;CAAA;AAxCD,kDAwCC","names":[],"sources":["C:\\Users\\Joseph\\Desktop\\Source\\User_Management_App\\app\\server\\tests\\__configurations__\\SQLiteTestContainer.ts"],"sourcesContent":["// tests/test-environment.ts\r\nimport 'reflect-metadata'; // Required by TypeORM\r\nimport { GenericContainer, StartedTestContainer } from \"testcontainers\";\r\nimport { DataSource, DataSourceOptions } from \"typeorm\";\r\nimport { Auth } from '../../src/entities/auth.entity';\r\nimport Contact from '../../src/entities/contact.entity';\r\nimport { Permission } from '../../src/entities/permission.entity';\r\nimport Profile from '../../src/entities/profile.entity';\r\nimport Role from '../../src/entities/role.entity';\r\nimport Status from '../../src/entities/status.entity';\r\nimport User from '../../src/entities/user.entity';\r\nimport { env } from 'process';\r\nimport { SeederOptions } from 'typeorm-extension';\r\nimport MainSeeder from '../../src/database/seeds/main.seed';\r\n\r\nconst options: DataSourceOptions & SeederOptions = {\r\n  type: \"sqlite\",\r\n  database: \"./tests/__database__/testdb.sqlite\", // Even in a container, in-memory is fastest for tests\r\n  entities: [User, Role, Status, Permission, Profile, Contact, Auth],\r\n  synchronize: true,\r\n  // These belong to SeederOptions\r\n //seeds: ['./src/database/seeds/**/*{.ts,.js}'],\r\n\r\n\r\n  factories: ['src/database/factories/**/*{.ts,.js}'],\r\n};\r\n\r\nconst SQLITE_IMAGE = \"keinos/sqlite3:latest\"; // Use a specific version in production code\r\n\r\n// Define the container (e.g., in a test utility file)\r\n\r\nexport class SQLiteTestContainer {\r\n  private sqliteContainer: StartedTestContainer | null = null;\r\n  private dataSource: DataSource;\r\n\r\n private readonly createSqliteContainer = async () => {\r\n  const container : StartedTestContainer= await new GenericContainer(SQLITE_IMAGE)\r\n    .withCommand([\"tail\", \"-f\", \"/dev/null\"]) // Keep the container alive\r\n    .start();\r\n\r\n\r\n  // Return connection details or a connection string\r\n  return { container };\r\n};\r\n\r\n  public startTestConatiner  = async ()=>{\r\n    console.log(\"Starting SQLite Test Container...\");\r\n    const details = await this.createSqliteContainer();\r\n    this.sqliteContainer = details.container;\r\n\r\n\r\n    this.dataSource = new DataSource(options);\r\n\r\n    await this.dataSource.initialize();\r\n\r\n  }\r\n\r\n  public stopTestConatiner  = async ()=>{\r\n    console.log(\"Stopping SQLite Test Container...\");  \r\n    if (this.dataSource.isInitialized){\r\n      await this.dataSource.destroy()\r\n    };\r\n    if (this.sqliteContainer){ \r\n      await this.sqliteContainer.stop();\r\n    };\r\n  }\r\n\r\n  public getDataSource =()=>{\r\n    return this.dataSource;\r\n  }\r\n\r\n}\r\n\r\n"],"version":3}