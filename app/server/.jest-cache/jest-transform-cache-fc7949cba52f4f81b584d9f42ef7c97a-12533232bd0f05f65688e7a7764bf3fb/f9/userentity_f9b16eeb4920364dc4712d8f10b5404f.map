{"file":"C:\\Users\\Joseph\\Desktop\\Source\\User_Management_App\\app\\server\\src\\entities\\user.entity.ts","mappings":"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","names":[],"sources":["C:\\Users\\Joseph\\Desktop\\Source\\User_Management_App\\app\\server\\src\\entities\\user.entity.ts"],"sourcesContent":["// src/entities/User.ts\r\nimport { Entity,  Column, PrimaryGeneratedColumn, JoinColumn, ManyToOne, ManyToMany, JoinTable, OneToMany } from \"typeorm\";\r\nimport { IsInt, IsString } from 'class-validator';\r\nimport { Audit } from \"../models/audit.model\";\r\nimport { UserType } from \"../types/user.type\";\r\nimport Role from \"./role.entity\";\r\nimport Status from \"./status.entity\";\r\nimport { SuspensionDetails } from \"../types/suspension-details.type\";\r\nimport { RBACPermission } from \"../types/rbac.type\";\r\nimport { Contact } from \"./contact.entity\";\r\n\r\n@Entity()\r\nexport class User extends Audit implements UserType {\r\n  @PrimaryGeneratedColumn() // SQLite uses auto-increment integers by default\r\n  id: number;\r\n\r\n  @Column({type: \"varchar\", length: 40, nullable: false, unique: false })\r\n  @IsString()\r\n  fullname: string;\r\n\r\n  @Column({type: \"varchar\", length: 40, nullable: false, unique: true })\r\n  @IsString()\r\n  username: string;\r\n\r\n  @Column()\r\n  @IsString()\r\n  email: string;\r\n\r\n  @Column({type: \"varchar\", length: 15, nullable: true })\r\n  @IsString()\r\n  phone: string;\r\n\r\n  @Column({type: \"varchar\", length: 100, nullable: false, //select: false \r\n\r\n   })\r\n  @IsString()\r\n  password: string;\r\n\r\n  @Column({type: \"integer\", default: 0, nullable: false, unsigned: true })\r\n  @IsInt()\r\n  failedLogins: number;\r\n\r\n  @Column({type: \"boolean\", default: true, nullable: false })\r\n  @IsInt()\r\n  isEnabled: boolean; \r\n\r\n    @Column({\r\n    type: \"json\", \r\n    nullable: true,\r\n    default: null\r\n  })\r\n  suspension: SuspensionDetails | null;\r\n\r\n  @ManyToOne(() => Status)\r\n  @JoinColumn({ name: 'status_id' })\r\n  status: Status; // This will hold the Status object when loaded\r\n\r\n  // ManyToMany relationship with Role, managed by a join table\r\n  @ManyToMany(() => Role, role => role.users,{ cascade: true })\r\n  @JoinTable({\r\n    name: 'user_roles', // Custom name for the join table\r\n    joinColumn: { name: 'user_id', referencedColumnName: 'id' },\r\n    inverseJoinColumn: { name: 'role_id', referencedColumnName: 'id' },\r\n    \r\n  })\r\n  roles: Role[];\r\n\r\n  // A user can have multiple contacts (one-to-many)\r\n  @OneToMany(() => Contact, (contact) => contact.user, { cascade: true })\r\n  contacts: Contact[];\r\n\r\n  getPermissionNames(): Array<RBACPermission> {\r\n\r\n    const uniquePermissions: Set<RBACPermission> = new Set();\r\n\r\n    for (let role of this.roles) {\r\n      for(let permission of role.permissions)\r\n        uniquePermissions.add(permission.rbacPermission());\r\n    }   \r\n    console.log(\"unique permissions: \", uniquePermissions);\r\n    const permissionList: RBACPermission[] = [...uniquePermissions];\r\n\r\n    return permissionList;\r\n  }\r\n\r\n}\r\n\r\nexport default User;\r\n\r\n\r\n\r\n"],"version":3}