{"file":"C:\\Users\\Joseph\\Desktop\\Source\\User_Management_App\\app\\server\\tests\\test.test.ts","mappings":";;;;;AACA,6DAAmD;AACnD,kFAA+E;AAC/E,0DAA+B;AAC/B,oCAAsC;AACtC,0DAA2D;AAC3D,gDAAwB;AACxB,yDAA8C;AAC9C,4FAAqE;AACrE,gFAAyD;AACzD,oFAA6D;AAC7D,QAAQ,CAAC,wCAAwC,EAAE,GAAG,EAAE;IAEtD,MAAM,eAAe,GAAG,IAAI,yCAAmB,EAAE,CAAC;IAClD,IAAI,UAAsB,CAAE;IAC5B,MAAM,GAAG,GAAG,IAAA,cAAQ,GAAE,CAAC;IAEvB,SAAS,CAAC,KAAK,IAAI,EAAE;QAEnB,MAAM,eAAe,CAAC,kBAAkB,EAAE,CAAC;QAC3C,UAAU,GAAG,eAAe,CAAC,aAAa,EAAE,CAAC;QAE7C,8DAA8D;QAChE,gDAAgD;QAChD,2FAA2F;QAC3F,WAAW;QACX,iFAAiF;QACjF,IAAI;QACJ,IAAA,2BAAc,EAAC,UAAU,CAAC,CAAC;QAEzB,MAAM,IAAA,6BAAS,EAAC,UAAU,EAAE,qBAAY,CAAC,CAAC;QAC1C,MAAM,IAAA,6BAAS,EAAC,UAAU,EAAE,mBAAU,CAAC,CAAC;QACxC,MAAM,IAAA,6BAAS,EAAC,UAAU,EAAE,yBAAgB,CAAC,CAAC;IAChD,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,kCAAkC;IAE5C,QAAQ,CAAC,KAAK,IAAI,EAAE;QAClB,MAAM,eAAe,CAAC,iBAAiB,EAAE,CAAC;QACtC,yDAAyD;QAC7D,MAAM,EAAE,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;QACzB,MAAM,WAAW,GAAG,cAAI,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,EAAE,oCAAoC,CAAC,CAAC;QACnF,IAAI,EAAE,CAAC,UAAU,CAAC,WAAW,CAAC,EAAE,CAAC;YAC/B,EAAE,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC;QAC7B,CAAC;IACH,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,mDAAmD,EAAE,KAAK,IAAI,EAAE;QACjE,MAAM,cAAc,GAAG,UAAU,CAAC,aAAa,CAAC,kBAAI,CAAC,CAAC;QAEtD,MAAM,IAAI,GAAG,cAAc,CAAC,MAAM,CAAC;YACjC,QAAQ,EAAE,WAAW;YACrB,QAAQ,EAAE,UAAU;YACpB,KAAK,EAAE,kBAAkB;YACzB,QAAQ,EAAE,UAAU;YACpB,SAAS,EAAE,IAAI;YACf,YAAY,EAAE,CAAC;SAChB,CAAC,CAAC;QAEH,MAAM,SAAS,GAAG,MAAM,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAClD,OAAO,CAAC,GAAG,CAAC,aAAa,EAAE,SAAS,CAAC,CAAC;QACtC,MAAM,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,WAAW,EAAE,CAAC;QACnC,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;IAC9C,CAAC,CAAC,CAAC;IAED,EAAE,CAAC,4CAA4C,EAAE,KAAK,IAAI,EAAE;QAC5D,MAAM,OAAO,GAAG;YACd,QAAQ,EAAE,gBAAgB;YAC1B,QAAQ,EAAE,gBAAgB;YAC1B,KAAK,EAAE,oBAAoB;YAC3B,QAAQ,EAAE,oBAAoB;YAC9B,KAAK,EAAC,aAAa;SACpB,CAAC;QAEF,MAAM,QAAQ,GAAG,MAAM,IAAA,mBAAO,EAAC,GAAG,CAAC;aAChC,IAAI,CAAC,iBAAiB,CAAC,CAAC,uDAAuD;aAC/E,IAAI,CAAC,OAAO,CAAC;aACb,GAAG,CAAC,QAAQ,EAAE,kBAAkB,CAAC,CAAC;QAEnC,OAAO,CAAC,GAAG,CAAC,gBAAgB,EAAE,QAAQ,CAAC,IAAI,CAAC,CAAC;QAE/C,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAClC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;QACtD,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,WAAW,EAAE,CAAC;IACzC,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,+CAA+C,EAAE,KAAK,IAAI,EAAE;QAC7D,sEAAsE;QACtE,MAAM,QAAQ,GAAG,MAAM,IAAA,mBAAO,EAAC,GAAG,CAAC;aAChC,IAAI,CAAC,QAAQ,CAAC;aACd,IAAI,CAAC,EAAE,QAAQ,EAAE,iBAAiB,EAAE,CAAC,CAAC;QACvC,OAAO,CAAC,GAAG,CAAC,oCAAoC,EAAE,QAAQ,CAAC,IAAI,CAAC,CAAC;QAEnE,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IACpC,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","names":[],"sources":["C:\\Users\\Joseph\\Desktop\\Source\\User_Management_App\\app\\server\\tests\\test.test.ts"],"sourcesContent":["import { DataSource } from \"typeorm\";\r\nimport { User } from \"../src/entities/user.entity\";\r\nimport { SQLiteTestContainer } from \"./__configurations__/SQLiteTestContainer\";\r\nimport request from \"supertest\"\r\nimport { buildApp } from \"../src/app\";\r\nimport { bindDataSource } from \"../src/configs/ioc.config\";\r\nimport path from \"path\";\r\nimport { runSeeder } from \"typeorm-extension\";\r\nimport PermissionSeeder from \"../src/database/seeds/permission.seed\";\r\nimport RoleSeeder from \"../src/database/seeds/role.seed\";\r\nimport StatusSeeder from \"../src/database/seeds/status.seed\";\r\ndescribe(\"User Entity with MariaDB Testcontainer\", () => {\r\n\r\n  const sqliteContainer = new SQLiteTestContainer();\r\n  let dataSource: DataSource ;\r\n  const app = buildApp();\r\n\r\n  beforeAll(async () => {\r\n\r\n    await sqliteContainer.startTestConatiner();\r\n    dataSource = sqliteContainer.getDataSource();\r\n\r\n    // FIX: Unbind the production DataSource and bind the Test one\r\n  // if (iocContainer.isBound(TYPES.DataSource)) {\r\n  //   (await iocContainer.rebind<DataSource>(TYPES.DataSource)).toConstantValue(dataSource);\r\n  // } else {\r\n  //   iocContainer.bind<DataSource>(TYPES.DataSource).toConstantValue(dataSource);\r\n  // }\r\n  bindDataSource(dataSource);\r\n\r\n    await runSeeder(dataSource, StatusSeeder);\r\n    await runSeeder(dataSource, RoleSeeder);\r\n    await runSeeder(dataSource, PermissionSeeder);\r\n  }, 6000); // Generous timeout for image pull\r\n\r\n  afterAll(async () => {\r\n    await sqliteContainer.stopTestConatiner();\r\n        // 2. Delete the local file (Manual cleanup for the file)\r\n    const fs = require('fs');\r\n    const localDbPath = path.join(process.cwd(), './tests/__database__/testdb.sqlite');\r\n    if (fs.existsSync(localDbPath)) {\r\n      fs.unlinkSync(localDbPath);\r\n    }\r\n  });\r\n\r\n  it(\"should save user with JSON and enums successfully\", async () => {\r\n    const userRepository = dataSource.getRepository(User);\r\n    \r\n    const user = userRepository.create({\r\n      fullname: \"Test User\",\r\n      username: \"testuser\",\r\n      email: \"test@example.com\",\r\n      password: \"password\",\r\n      isEnabled: true,\r\n      failedLogins: 0,\r\n    });\r\n\r\n    const savedUser = await userRepository.save(user);\r\n    console.log(\"Saved User:\", savedUser);\r\n    expect(savedUser.id).toBeDefined();\r\n    expect(savedUser.password).toBe(\"password\");\r\n  });\r\n\r\n    it('should create a new user via TSOA endpoint', async () => {\r\n    const payload = {\r\n      fullname: \"Supertest User\",\r\n      username: \"supertest_user\",\r\n      email: \"tester@example.com\",\r\n      password: \"@securePassword123\",\r\n      phone:\"12412348901\",\r\n    };\r\n\r\n    const response = await request(app)\r\n      .post('/auths/register') // The route defined in your @Route('/users') decorator\r\n      .send(payload)\r\n      .set('Accept', 'application/json');\r\n\r\n      console.log(\"Response Body:\", response.body);\r\n\r\n    expect(response.status).toBe(201);\r\n    expect(response.body.username).toBe(payload.username);\r\n    expect(response.body.id).toBeDefined();\r\n  });\r\n\r\n  it('should return 422 for invalid tsoa validation', async () => {\r\n    // tsoa automatically returns 422 for missing fields/validation errors\r\n    const response = await request(app)\r\n      .post('/users')\r\n      .send({ fullname: \"Incomplete User\" });\r\n      console.log(\"Response Body for Invalid Request:\", response.body);\r\n\r\n    expect(response.status).toBe(404);\r\n  });\r\n});\r\n"],"version":3}