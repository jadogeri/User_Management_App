d4fa9a31fdb30375682c0d2f7181ac80
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
const decorators_1 = require("../decorators");
const error_response_model_1 = require("../models/error-response.model");
const validation_response_model_1 = require("../models/validation-response.model");
const input_validation_util_1 = require("../utils/input-validation.util");
let CredentialValidatorService = class CredentialValidatorService {
    validateRegistration(userRequest) {
        const { username, email, password, phone } = userRequest;
        if (!username || !email || !password) {
            return new validation_response_model_1.ValidationResponse(false, new error_response_model_1.ErrorResponse(400, "All fields are mandatory!"));
        }
        if (!(0, input_validation_util_1.isValidEmail)(email)) {
            return new validation_response_model_1.ValidationResponse(false, new error_response_model_1.ErrorResponse(400, "not a valid email"));
        }
        if (!(0, input_validation_util_1.isValidUsername)(username)) {
            return new validation_response_model_1.ValidationResponse(false, new error_response_model_1.ErrorResponse(400, "not a valid username"));
        }
        if (!(0, input_validation_util_1.isValidPassword)(password)) {
            return new validation_response_model_1.ValidationResponse(false, new error_response_model_1.ErrorResponse(400, "not a valid password"));
        }
        //if phone number is provided check if string is a valid phone number
        if (phone) {
            if (!(0, input_validation_util_1.isValidatePhoneNumber)(phone)) {
                return new validation_response_model_1.ValidationResponse(false, new error_response_model_1.ErrorResponse(400, "not a valid phone number"));
            }
        }
        return new validation_response_model_1.ValidationResponse(true);
    }
    validateLogin(userRequest) {
        const { email, password } = userRequest;
        if (!email || !password) {
            return new validation_response_model_1.ValidationResponse(false, new error_response_model_1.ErrorResponse(400, "All fields are mandatory!"));
        }
        if (!(0, input_validation_util_1.isValidEmail)(email)) {
            return new validation_response_model_1.ValidationResponse(false, new error_response_model_1.ErrorResponse(400, "not a valid standard email address"));
        }
        return new validation_response_model_1.ValidationResponse(true);
    }
    validateForgotPassword(userRequest) {
        const { email } = userRequest;
        if (!email) {
            return new validation_response_model_1.ValidationResponse(false, new error_response_model_1.ErrorResponse(400, "Email is mandatory!"));
        }
        if (!(0, input_validation_util_1.isValidEmail)(email)) {
            return new validation_response_model_1.ValidationResponse(false, new error_response_model_1.ErrorResponse(400, "not a  valid email"));
        }
        return new validation_response_model_1.ValidationResponse(true);
    }
    validateLogout(userRequest) {
        const token = userRequest.token;
        if (!token) {
            return new validation_response_model_1.ValidationResponse(false, new error_response_model_1.ErrorResponse(400, "field token is mandatory"));
        }
        return new validation_response_model_1.ValidationResponse(true);
    }
    validateResetPassword(userRequest) {
        const { email, oldPassword, newPassword, confirmNewPassword } = userRequest;
        if (!email || !oldPassword || !newPassword || !confirmNewPassword) {
            return new validation_response_model_1.ValidationResponse(false, new error_response_model_1.ErrorResponse(400, "All fields are mandatory!"));
        }
        if (!(0, input_validation_util_1.isValidEmail)(email)) {
            return new validation_response_model_1.ValidationResponse(false, new error_response_model_1.ErrorResponse(400, "not a  valid email"));
        }
        if (!(0, input_validation_util_1.isValidPassword)(newPassword)) {
            return new validation_response_model_1.ValidationResponse(false, new error_response_model_1.ErrorResponse(400, "not a valid new password"));
        }
        if (newPassword !== confirmNewPassword) {
            return new validation_response_model_1.ValidationResponse(false, new error_response_model_1.ErrorResponse(400, "passwords do not match"));
        }
        return new validation_response_model_1.ValidationResponse(true);
    }
    validateDeactivate(userRequest) {
        const { email, password, confirmDeactivation } = userRequest;
        if (!email || !password || confirmDeactivation == undefined) {
            return new validation_response_model_1.ValidationResponse(false, new error_response_model_1.ErrorResponse(400, "All fields are mandatory!"));
        }
        if (!(0, input_validation_util_1.isValidEmail)(email)) {
            return new validation_response_model_1.ValidationResponse(false, new error_response_model_1.ErrorResponse(400, "not a  valid email"));
        }
        if (confirmDeactivation !== true) {
            return new validation_response_model_1.ValidationResponse(false, new error_response_model_1.ErrorResponse(400, "confirm must be true"));
        }
        return new validation_response_model_1.ValidationResponse(true);
    }
};
CredentialValidatorService = __decorate([
    (0, decorators_1.Service)()
], CredentialValidatorService);
exports.default = CredentialValidatorService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxKb3NlcGhcXERlc2t0b3BcXFNvdXJjZVxcVXNlcl9NYW5hZ2VtZW50X0FwcFxcYXBwXFxzZXJ2ZXJcXHNyY1xcc2VydmljZXNcXGNyZWRlbnRpYWwtdmFsaWRhdG9yLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFDQSw4Q0FBd0M7QUFLeEMseUVBQStEO0FBQy9ELG1GQUF5RTtBQUN6RSwwRUFBb0g7QUFHcEgsSUFBTSwwQkFBMEIsR0FBaEMsTUFBTSwwQkFBMEI7SUFFNUIsb0JBQW9CLENBQUMsV0FBaUM7UUFDbEQsTUFBTSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxHQUFHLFdBQVcsQ0FBQztRQUV6RCxJQUFJLENBQUMsUUFBUSxJQUFJLENBQUMsS0FBSyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDbkMsT0FBTyxJQUFJLDhDQUFrQixDQUFDLEtBQUssRUFBRSxJQUFJLG9DQUFhLENBQUMsR0FBRyxFQUFDLDJCQUEyQixDQUFDLENBQUMsQ0FBQztRQUM3RixDQUFDO1FBQ0QsSUFBRyxDQUFDLElBQUEsb0NBQVksRUFBQyxLQUFLLENBQUMsRUFBQyxDQUFDO1lBQ3JCLE9BQU8sSUFBSSw4Q0FBa0IsQ0FBQyxLQUFLLEVBQUUsSUFBSSxvQ0FBYSxDQUFDLEdBQUcsRUFBQyxtQkFBbUIsQ0FBQyxDQUFDLENBQUM7UUFDckYsQ0FBQztRQUNELElBQUcsQ0FBQyxJQUFBLHVDQUFlLEVBQUMsUUFBUSxDQUFDLEVBQUMsQ0FBQztZQUMzQixPQUFPLElBQUksOENBQWtCLENBQUMsS0FBSyxFQUFFLElBQUksb0NBQWEsQ0FBQyxHQUFHLEVBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDO1FBRXhGLENBQUM7UUFDRCxJQUFHLENBQUMsSUFBQSx1Q0FBZSxFQUFDLFFBQVEsQ0FBQyxFQUFDLENBQUM7WUFDM0IsT0FBTyxJQUFJLDhDQUFrQixDQUFDLEtBQUssRUFBRSxJQUFJLG9DQUFhLENBQUMsR0FBRyxFQUFDLHNC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QixJQUFBLG9CQUFPLEdBQUU7R0FDSiwwQkFBMEIsQ0F1Ry9CO0FBRUQsa0JBQWUsMEJBQTBCLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxKb3NlcGhcXERlc2t0b3BcXFNvdXJjZVxcVXNlcl9NYW5hZ2VtZW50X0FwcFxcYXBwXFxzZXJ2ZXJcXHNyY1xcc2VydmljZXNcXGNyZWRlbnRpYWwtdmFsaWRhdG9yLnNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiXHJcbmltcG9ydCB7IFNlcnZpY2UgfSBmcm9tIFwiLi4vZGVjb3JhdG9yc1wiO1xyXG5pbXBvcnQgeyBBdXRoTG9naW5SZXF1ZXN0RFRPLCBBdXRoRm9yZ290UGFzc3dvcmRSZXF1ZXN0RFRPLCBBdXRoUmVzZXRQYXNzd29yZFJlcXVlc3REVE8gfSBmcm9tIFwiLi4vZHRvcy9yZXF1ZXN0cy9hdXRoLXJlcXVlc3QuZHRvXCI7XHJcbmltcG9ydCB7IFVzZXJDcmVhdGVSZXF1ZXN0RFRPLCBVc2VyRGVhY3RpdmF0ZVJlcXVlc3REVE8gfSBmcm9tIFwiLi4vZHRvcy9yZXF1ZXN0cy91c2VyLXJlcXVlc3QuZHRvXCI7XHJcbmltcG9ydCB7IENyZWRlbnRpYWxWYWxpZGF0b3JTZXJ2aWNlSW50ZXJmYWNlIH0gZnJvbSBcIi4uL2ludGVyZmFjZXMvY3JlZGVudGlhbC12YWxpZGF0b3Itc2VydmljZS5pbnRlcmZhY2VcIjtcclxuaW1wb3J0IHsgSnd0UGF5bG9hZEludGVyZmFjZSB9IGZyb20gXCIuLi9pbnRlcmZhY2VzL2p3dC1wYXlsb2FkLmludGVyZmFjZVwiO1xyXG5pbXBvcnQgeyBFcnJvclJlc3BvbnNlIH0gZnJvbSBcIi4uL21vZGVscy9lcnJvci1yZXNwb25zZS5tb2RlbFwiO1xyXG5pbXBvcnQgeyBWYWxpZGF0aW9uUmVzcG9uc2UgfSBmcm9tIFwiLi4vbW9kZWxzL3ZhbGlkYXRpb24tcmVzcG9uc2UubW9kZWxcIjtcclxuaW1wb3J0IHtpc1ZhbGlkRW1haWwsIGlzVmFsaWRQYXNzd29yZCwgaXNWYWxpZFVzZXJuYW1lLCBpc1ZhbGlkYXRlUGhvbmVOdW1iZXJ9IGZyb20gXCIuLi91dGlscy9pbnB1dC12YWxpZGF0aW9uLnV0aWxcIlxyXG5cclxuQFNlcnZpY2UoKVxyXG5jbGFzcyBDcmVkZW50aWFsVmFsaWRhdG9yU2VydmljZSBpbXBsZW1lbnRzIENyZWRlbnRpYWxWYWxpZGF0b3JTZXJ2aWNlSW50ZXJmYWNle1xyXG5cclxuICAgIHZhbGlkYXRlUmVnaXN0cmF0aW9uKHVzZXJSZXF1ZXN0OiBVc2VyQ3JlYXRlUmVxdWVzdERUTyk6IFZhbGlkYXRpb25SZXNwb25zZXtcclxuICAgICAgICBjb25zdCB7IHVzZXJuYW1lLCBlbWFpbCwgcGFzc3dvcmQsIHBob25lIH0gPSB1c2VyUmVxdWVzdDtcclxuXHJcbiAgICAgICAgaWYgKCF1c2VybmFtZSB8fCAhZW1haWwgfHwgIXBhc3N3b3JkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgVmFsaWRhdGlvblJlc3BvbnNlKGZhbHNlLCBuZXcgRXJyb3JSZXNwb25zZSg0MDAsXCJBbGwgZmllbGRzIGFyZSBtYW5kYXRvcnkhXCIpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoIWlzVmFsaWRFbWFpbChlbWFpbCkpe1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFZhbGlkYXRpb25SZXNwb25zZShmYWxzZSwgbmV3IEVycm9yUmVzcG9uc2UoNDAwLFwibm90IGEgdmFsaWQgZW1haWxcIikpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZighaXNWYWxpZFVzZXJuYW1lKHVzZXJuYW1lKSl7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgVmFsaWRhdGlvblJlc3BvbnNlKGZhbHNlLCBuZXcgRXJyb3JSZXNwb25zZSg0MDAsXCJub3QgYSB2YWxpZCB1c2VybmFtZVwiKSk7XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBpZighaXNWYWxpZFBhc3N3b3JkKHBhc3N3b3JkKSl7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgVmFsaWRhdGlvblJlc3BvbnNlKGZhbHNlLCBuZXcgRXJyb3JSZXNwb25zZSg0MDAsXCJub3QgYSB2YWxpZCBwYXNzd29yZFwiKSk7XHJcbiAgICAgICAgfSAgXHJcbiAgICAgICAgLy9pZiBwaG9uZSBudW1iZXIgaXMgcHJvdmlkZWQgY2hlY2sgaWYgc3RyaW5nIGlzIGEgdmFsaWQgcGhvbmUgbnVtYmVyXHJcbiAgICAgICAgaWYocGhvbmUpe1xyXG5cclxuICAgICAgICAgICAgaWYoIWlzVmFsaWRhdGVQaG9uZU51bWJlcihwaG9uZSApKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVmFsaWRhdGlvblJlc3BvbnNlKGZhbHNlLCBuZXcgRXJyb3JSZXNwb25zZSg0MDAsXCJub3QgYSB2YWxpZCBwaG9uZSBudW1iZXJcIikpO1xyXG4gICAgICAgICAgICB9ICBcclxuICAgICAgICB9ICAgIFxyXG5cclxuICAgICAgICByZXR1cm4gbmV3IFZhbGlkYXRpb25SZXNwb25zZSh0cnVlKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgdmFsaWRhdGVMb2dpbih1c2VyUmVxdWVzdDogQXV0aExvZ2luUmVxdWVzdERUTyk6IFZhbGlkYXRpb25SZXNwb25zZXtcclxuICAgICAgICBjb25zdCB7IGVtYWlsLCBwYXNzd29yZCAgfSA9IHVzZXJSZXF1ZXN0O1xyXG4gICAgICAgIGlmICghZW1haWwgfHwgIXBhc3N3b3JkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgVmFsaWRhdGlvblJlc3BvbnNlKGZhbHNlLCBuZXcgRXJyb3JSZXNwb25zZSg0MDAsXCJBbGwgZmllbGRzIGFyZSBtYW5kYXRvcnkhXCIpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKCFpc1ZhbGlkRW1haWwoZW1haWwpKXtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uUmVzcG9uc2UoZmFsc2UsIG5ldyBFcnJvclJlc3BvbnNlKDQwMCxcIm5vdCBhIHZhbGlkIHN0YW5kYXJkIGVtYWlsIGFkZHJlc3NcIikpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uUmVzcG9uc2UodHJ1ZSk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHZhbGlkYXRlRm9yZ290UGFzc3dvcmQodXNlclJlcXVlc3Q6IEF1dGhGb3Jnb3RQYXNzd29yZFJlcXVlc3REVE8pOiBWYWxpZGF0aW9uUmVzcG9uc2V7XHJcbiAgICAgICAgY29uc3QgeyBlbWFpbCB9ID0gdXNlclJlcXVlc3Q7XHJcblxyXG4gICAgICAgIGlmKCFlbWFpbCl7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgVmFsaWRhdGlvblJlc3BvbnNlKGZhbHNlLCBuZXcgRXJyb3JSZXNwb25zZSg0MDAsXCJFbWFpbCBpcyBtYW5kYXRvcnkhXCIpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoIWlzVmFsaWRFbWFpbChlbWFpbCkpe1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFZhbGlkYXRpb25SZXNwb25zZShmYWxzZSwgbmV3IEVycm9yUmVzcG9uc2UoNDAwLFwibm90IGEgIHZhbGlkIGVtYWlsXCIpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uUmVzcG9uc2UodHJ1ZSk7XHJcblxyXG5cclxuICAgIH1cclxuXHJcbiAgICB2YWxpZGF0ZUxvZ291dCh1c2VyUmVxdWVzdDogSnd0UGF5bG9hZEludGVyZmFjZSk6IFZhbGlkYXRpb25SZXNwb25zZXtcclxuICAgICAgICBjb25zdCB0b2tlbiA9IHVzZXJSZXF1ZXN0LnRva2VuO1xyXG4gICAgICAgIGlmKCF0b2tlbil7IFxyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFZhbGlkYXRpb25SZXNwb25zZShmYWxzZSwgbmV3IEVycm9yUmVzcG9uc2UoNDAwLFwiZmllbGQgdG9rZW4gaXMgbWFuZGF0b3J5XCIpKTtcclxuICAgICAgICB9IFxyXG4gICAgICAgIHJldHVybiBuZXcgVmFsaWRhdGlvblJlc3BvbnNlKHRydWUpO1xyXG4gICAgfVxyXG5cclxuICAgIHZhbGlkYXRlUmVzZXRQYXNzd29yZCh1c2VyUmVxdWVzdDogQXV0aFJlc2V0UGFzc3dvcmRSZXF1ZXN0RFRPKTogVmFsaWRhdGlvblJlc3BvbnNle1xyXG4gICAgICAgIGNvbnN0IHsgZW1haWwsIG9sZFBhc3N3b3JkLCBuZXdQYXNzd29yZCwgY29uZmlybU5ld1Bhc3N3b3JkIH0gPSB1c2VyUmVxdWVzdDtcclxuICAgICAgICBpZiAoIWVtYWlsIHx8ICFvbGRQYXNzd29yZCB8fCAhbmV3UGFzc3dvcmQgfHwgIWNvbmZpcm1OZXdQYXNzd29yZCkge1xyXG4gICAgICAgICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uUmVzcG9uc2UoZmFsc2UsIG5ldyBFcnJvclJlc3BvbnNlKDQwMCAsXCJBbGwgZmllbGRzIGFyZSBtYW5kYXRvcnkhXCIpKTtcclxuICAgIFxyXG4gICAgICAgIH1cclxuICAgICAgICBpZighaXNWYWxpZEVtYWlsKGVtYWlsKSl7XHJcbiAgICAgICAgICByZXR1cm4gbmV3IFZhbGlkYXRpb25SZXNwb25zZShmYWxzZSwgbmV3IEVycm9yUmVzcG9uc2UoNDAwLFwibm90IGEgIHZhbGlkIGVtYWlsXCIpKTtcclxuICAgICAgXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKCFpc1ZhbGlkUGFzc3dvcmQobmV3UGFzc3dvcmQpKXtcclxuICAgICAgICAgIHJldHVybiBuZXcgVmFsaWRhdGlvblJlc3BvbnNlKGZhbHNlLCBuZXcgRXJyb3JSZXNwb25zZSg0MDAsXCJub3QgYSB2YWxpZCBuZXcgcGFzc3dvcmRcIikpO1xyXG4gICAgICAgIH0gIFxyXG4gICAgICAgIGlmKG5ld1Bhc3N3b3JkICE9PSBjb25maXJtTmV3UGFzc3dvcmQpe1xyXG4gICAgICAgICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uUmVzcG9uc2UoZmFsc2UsIG5ldyBFcnJvclJlc3BvbnNlKDQwMCxcInBhc3N3b3JkcyBkbyBub3QgbWF0Y2hcIikpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbmV3IFZhbGlkYXRpb25SZXNwb25zZSh0cnVlKTsgICAgXHJcblxyXG4gICAgfVxyXG4gICAgdmFsaWRhdGVEZWFjdGl2YXRlKHVzZXJSZXF1ZXN0OiBVc2VyRGVhY3RpdmF0ZVJlcXVlc3REVE8pOiBWYWxpZGF0aW9uUmVzcG9uc2V7XHJcbiAgICAgICAgY29uc3QgeyBlbWFpbCwgcGFzc3dvcmQsIGNvbmZpcm1EZWFjdGl2YXRpb259IDogVXNlckRlYWN0aXZhdGVSZXF1ZXN0RFRPICA9IHVzZXJSZXF1ZXN0XHJcbiAgICAgICAgaWYgKCFlbWFpbCB8fCAhcGFzc3dvcmQgfHwgY29uZmlybURlYWN0aXZhdGlvbiA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uUmVzcG9uc2UoZmFsc2UsIG5ldyBFcnJvclJlc3BvbnNlKDQwMCxcIkFsbCBmaWVsZHMgYXJlIG1hbmRhdG9yeSFcIikpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZighaXNWYWxpZEVtYWlsKGVtYWlsICkpe1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFZhbGlkYXRpb25SZXNwb25zZShmYWxzZSwgbmV3IEVycm9yUmVzcG9uc2UoNDAwLFwibm90IGEgIHZhbGlkIGVtYWlsXCIpKTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKGNvbmZpcm1EZWFjdGl2YXRpb24gIT09IHRydWUpe1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFZhbGlkYXRpb25SZXNwb25zZShmYWxzZSwgbmV3IEVycm9yUmVzcG9uc2UoNDAwLFwiY29uZmlybSBtdXN0IGJlIHRydWVcIikpO1xyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uUmVzcG9uc2UodHJ1ZSk7ICAgIFxyXG5cclxuICAgIH1cclxuXHJcbiAgICBcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgQ3JlZGVudGlhbFZhbGlkYXRvclNlcnZpY2U7Il0sInZlcnNpb24iOjN9