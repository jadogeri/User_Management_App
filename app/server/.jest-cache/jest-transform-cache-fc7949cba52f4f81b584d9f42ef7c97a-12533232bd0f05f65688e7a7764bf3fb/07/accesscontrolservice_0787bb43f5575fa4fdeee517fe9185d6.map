{"file":"C:\\Users\\Joseph\\Desktop\\Source\\User_Management_App\\app\\server\\src\\services\\access-control.service.ts","mappings":"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","names":[],"sources":["C:\\Users\\Joseph\\Desktop\\Source\\User_Management_App\\app\\server\\src\\services\\access-control.service.ts"],"sourcesContent":["\r\nimport { Service } from \"../decorators\";\r\nimport Role from \"../entities/role.entity\";\r\nimport User from \"../entities/user.entity\";\r\nimport { AccessControlInterface } from \"../interfaces/access-control.interface\";\r\nimport { Action, Resource } from \"../types/rbac.type\";\r\nimport { RoleNamesEnum } from \"../types/role-names.type\";\r\nimport { StatusEnum } from \"../types/status.type\";\r\n\r\n@Service()\r\nclass AccessControlService implements AccessControlInterface{\r\n\r\n    private userRoles: Role[] = []; // This should be set based on the authenticated user's roles\r\n\r\n    setUserRoles(roles: Role[]){\r\n        this.userRoles = roles;\r\n    }\r\n\r\n    hasRole(role: RoleNamesEnum): boolean {\r\n        for(const userRole of this.userRoles){\r\n            if(userRole.name === role){\r\n                console.log(\"user has role in accwss control: \", role);\r\n                return true;\r\n            }\r\n        }\r\n        console.log(\"user does not have role in access control: \", role);\r\n\r\n        return false;\r\n    }\r\n    hasFullAccess(grants: {resource: string, action: string}[]): boolean {\r\n        return grants.some(\r\n            grant => grant.resource === '*' && grant.action === '*'\r\n        );    \r\n    }\r\n\r\n    getGrants(): {resource: string, action: string}[] {\r\n        if(this.userRoles.length === 0){\r\n            return []; // No roles assigned to the user\r\n        }  \r\n        const grants = this.userRoles.flatMap(role => role.permissions.map(permission => ({\r\n            resource: permission.resource,\r\n            action: permission.action,\r\n        })));\r\n        return grants;  \r\n    }               \r\n\r\n /**\r\n   * Checks if the user has permission to perform an action on a resource.\r\n   * @param action The action (e.g., 'read', 'delete')\r\n   * @param resource The resource (e.g., 'user', 'product')\r\n   * @returns boolean - true if permitted, false otherwise\r\n   */\r\n  public can(action: Action, resource: Resource): boolean {\r\n\r\n    if(this.userRoles.length === 0){\r\n        return false; // No roles assigned to the user\r\n    }\r\n\r\n    const grants = this.getGrants();\r\n\r\n    // Check for super admin/wildcard access\r\n    const hasFullAccess = this.hasFullAccess(grants);\r\n    if (hasFullAccess) {\r\n        console.log(\"user has full access line 62 in access control service\");\r\n      return true;\r\n    }\r\n\r\n    // Check specific grants\r\n    for (const grant of grants) {\r\n      const resourceMatches = grant.resource === '*' || grant.resource === resource;\r\n      const actionMatches = grant.action === '*' || grant.action === action;\r\n\r\n      if (resourceMatches && actionMatches) {\r\n        console.log(`user has permission for action ${action} on resource ${resource} in access control service`);\r\n        return true;\r\n      }\r\n    }\r\n    \r\n    console.log(`user does not have permission for action ${action} on resource ${resource} in access control service`);\r\n    return false; // No matching grant found\r\n  \r\n    }    \r\n\r\n    isAccountSuspended(user: User): boolean {\r\n        const isSuspended : boolean = user?.suspension !== null;\r\n        return isSuspended;\r\n    }\r\n    isAccountDisabled(user: User): boolean {\r\n        const isDisabled : boolean = user?.status.name === StatusEnum.DISABLED || user.isEnabled === false;\r\n        return isDisabled;\r\n    }\r\n    isAccountLocked(user: User): boolean {\r\n        const isLocked : boolean = user?.status.name === StatusEnum.LOCKED || user.isEnabled === false;\r\n        return isLocked;\r\n    }\r\n}\r\n\r\nexport default AccessControlService;"],"version":3}