{"file":"C:\\Users\\Joseph\\Desktop\\Source\\User_Management_App\\app\\server\\src\\app.ts","mappings":"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","names":[],"sources":["C:\\Users\\Joseph\\Desktop\\Source\\User_Management_App\\app\\server\\src\\app.ts"],"sourcesContent":["import express,{ Application } from 'express';\r\nimport * as bodyParser from \"body-parser\";\r\nimport cookieParser from \"cookie-parser\";\r\nimport { RegisterRoutes } from \"./routes\";\r\nimport * as swaggerJson from \"./swagger.json\";\r\nimport * as swaggerUI from \"swagger-ui-express\";\r\nimport cors from 'cors';\r\nimport { corsOptions } from './configs/cors.config';\r\nimport morgan from 'morgan';\r\nimport fs from 'fs';\r\nimport path from 'path';\r\nimport rateLimit from 'express-rate-limit';\r\nimport helmet from 'helmet';\r\nimport expressWinston from 'express-winston';\r\nimport { transports, format } from 'winston';\r\n\r\n// importing controllers to ensure they are registered\r\nimport \"./controllers/user.controller\";\r\nimport \"./controllers/auth.controller\";\r\nimport \"./controllers/profile.controller\";\r\n\r\n\r\nimport { helmetOptions } from './configs/helmet.config';\r\nimport { applicationErrorLogger } from './middlewares/application-error-logger.middleware';\r\nimport { customLogger } from './middlewares/custom-logger.middleware';\r\nimport { globalErrorHandler } from './middlewares/global-error-handler.middleware';\r\nimport { noRouteFoundHandler } from './middlewares/no-route-found-handler.middleware';\r\n\r\nexport const buildApp = () : Application  =>{\r\n\r\n    const app: Application = express();\r\n\r\n    //app.use(customLogger);\r\n    //middlewares\r\n    app.use(express.json())\r\n    app.use(cookieParser());\r\n    app.use(bodyParser.json());\r\n    app.use(bodyParser.urlencoded({ extended: true }));\r\n\r\n    // Use the configured CORS middleware\r\n    app.use(cors(corsOptions));\r\n    // Enable pre-flight requests for all routes (necessary when using specific headers/methods)\r\n    //app.options('*', cors(corsOptions) as any); \r\n    const morganFormat = process?.env?.NODE_ENV === 'production' ? 'combined' : 'dev';\r\n    //app.use(morgan(morganFormat));// Logging middleware     \r\n    // Create a write stream (in append mode)\r\n    console.log(\"__dirname:\", __dirname);   \r\n    const accessLogStream = fs.createWriteStream(path.join(__dirname, 'logs', 'access.log'), { flags: 'a' });\r\n    \r\n\r\n    // Setup the logger to use the 'combined' format and stream to the file\r\n    //app.use(morgan('combined', { stream: accessLogStream }))  \r\n\r\n    // Rate Limiting Middleware\r\n    // Global rate limiter configuration\r\n    const apiLimiter = rateLimit({\r\n    windowMs: 15 * 60 * 1000, // 15 minutes\r\n    max: 100, // limit each IP to 100 requests per windowMs\r\n    message:\r\n        'Too many requests from this IP, please try again after 15 minutes',\r\n    standardHeaders: true, // Return rate limit info in the `RateLimit-*` headers\r\n    legacyHeaders: false, // Disable the `X-RateLimit-*` headers\r\n    });\r\n\r\n    // Apply the rate limiting middleware to all requests\r\n    //app.use(apiLimiter);\r\n    // Security Middleware\r\n    //app.use(helmet(helmetOptions));\r\n    \r\n    RegisterRoutes(app);\r\n    \r\n    app.use([\"/openapi\", \"/docs\", \"/swagger\"], swaggerUI.serve, swaggerUI.setup(swaggerJson));\r\n\r\n        console.log(\"dirname in app.ts:\", __dirname);\r\n\r\n    // Serve static files from the React build directory\r\n    // The path.join ensures it works correctly across different operating systems\r\n    const buildPath = path.join(__dirname, '../..', 'client', 'build');\r\n    app.use(express.static(buildPath));\r\n\r\n    // All other GET requests not handled by previous routes\r\n    // (including the static files middleware) will be handled here\r\n    // This ensures that React Router works correctly for client-side routing\r\n    app.get('/*splat', (req, res) => {\r\n        res.sendFile(path.join(buildPath, 'index.html'));\r\n    });\r\n\r\n\r\n\r\n//     const myFormat  = format.printf(({ level: string, meta: any, timestamp }) => {\r\n//     return `${timestamp} ${level}: ${meta.message}`\r\n// })\r\n\r\n// app.use(expressWinston.errorLogger({\r\n//     transports: [\r\n//         new transports.File({\r\n//             filename: 'logsInternalErrors.log'\r\n//         })\r\n//     ],\r\n//     format: format.combine(\r\n//         format.json(),\r\n//         format.timestamp(),\r\n//         //myFormat\r\n\r\n//     )\r\n// }))\r\n\r\n//app.use(applicationErrorLogger);\r\n\r\napp.use(globalErrorHandler);\r\napp.use(noRouteFoundHandler)\r\n\r\n    return app;\r\n    \r\n}\r\n\r\n\r\n\r\n"],"version":3}