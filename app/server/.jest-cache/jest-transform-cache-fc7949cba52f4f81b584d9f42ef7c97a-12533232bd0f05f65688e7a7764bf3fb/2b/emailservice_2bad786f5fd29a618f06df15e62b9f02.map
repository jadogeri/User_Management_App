{"file":"C:\\Users\\Joseph\\Desktop\\Source\\User_Management_App\\app\\server\\src\\services\\email.service.ts","mappings":";;;;;;;;;;;;;;AACA,8CAAwC;AAExC,uEAA6D;AAC7D,mEAA+D;AAC/D,sFAA6D;AAK7D,IACM,YAAY,GADlB,MACM,YAAY;IAGhB;QACE,IAAI,CAAC,YAAY,GAAG,IAAI,kCAAY,EAAE,CAAC;IACzC,CAAC;IAEM,KAAK,CAAC,SAAS,CAAC,YAAqB,EAAE,SAAqB;QACjE,OAAO,CAAC,GAAG,CAAC,8CAA8C,EAAE,YAAY,EAAE,gBAAgB,EAAE,SAAS,CAAC,CAAC;QAEvG,SAAS,CAAC,QAAQ,GAAG,OAAO,CAAC,GAAG,CAAC,mBAAmB,CAAC;QACrD,SAAS,CAAC,OAAO,GAAG,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE,CAAC;QACnD,SAAS,CAAC,OAAO,GAAG,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE,CAAC;QACnD,SAAS,CAAC,IAAI,GAAG,IAAI,CAAC,YAAY,CAAC,OAAO,EAAE,CAAC;QAE7C,MAAM,IAAA,2BAAY,EAAC,YAAY,EAAE,SAAS,CAAC;aAC1C,IAAI,CAAC,CAAC,MAAW,EAAE,EAAE;YAClB,MAAM,IAAI,GAAU;gBAChB,EAAE,EAAE,MAAM,CAAC,SAAS,CAAC,KAAK;gBAC1B,IAAI,EAAE,SAAS,CAAC,OAAiB;gBACjC,OAAO,EAAE,MAAM,CAAC,KAAK,CAAC,OAAO;gBAC7B,IAAI,EAAE,MAAM,CAAC,KAAK,CAAC,IAAI;gBACvB,IAAI,EAAE,MAAM,CAAC,KAAK,CAAC,IAAI;aAC1B,CAAA;YACD,IAAG,CAAC,SAAS,CAAC,KAAK,IAAI,SAAS,CAAC,KAAK,IAAI,SAAS,EAAC,CAAC;gBACjD,MAAM,IAAI,KAAK,CAAC,qBAAqB,CAAC,CAAA;YAC1C,CAAC;YACD,IAAA,uBAAa,EAAC,IAAI,CAAC;iBAClB,IAAI,CAAC,GAAE,EAAE;gBACN,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAA;YACzB,CAAC,CAAC;iBACD,KAAK,CAAC,CAAC,KAAU,EAAE,EAAE;gBAClB,OAAO,CAAC,GAAG,CAAC,yBAAyB,EAAE,KAAK,CAAC,CAAC;gBAC9C,OAAO,KAAK,CAAA;YAChB,CAAC,CAAE,CAAA;QAEP,CAAC,CAAC;aACD,KAAK,CAAC,CAAC,KAAc,EAAC,EAAE;YACrB,OAAO,KAAK,CAAA;QAChB,CAAC,CAAC,CAAA;IAEJ,CAAC;CACF,CAAA;AA1CK,YAAY;IADjB,IAAA,oBAAO,GAAE;;GACJ,YAAY,CA0CjB;AAED,kBAAe,YAAY,CAAC;AAqB5B;;;;;;;;;;;;;;;;;;;;GAoBG","names":[],"sources":["C:\\Users\\Joseph\\Desktop\\Source\\User_Management_App\\app\\server\\src\\services\\email.service.ts"],"sourcesContent":["\r\nimport { Service } from \"../decorators\";\r\nimport { EmailServiceInterface } from \"../interfaces/email-service.interface\";\r\nimport { EmailContext } from \"../models/email-context.model\";\r\nimport { loadTemplate } from \"../tools/mail/utils/loadTemplate\"\r\nimport transportMail from \"../tools/mail/utils/transportMail\"\r\nimport { Mail } from \"../types/mail.type\";\r\nimport { Recipient } from \"../types/recipient.type\";\r\n\r\n\r\n@Service()\r\nclass EmailService implements EmailServiceInterface{\r\n\r\n  private readonly emailContext: EmailContext;\r\n  constructor(){\r\n    this.emailContext = new EmailContext();\r\n  }        \r\n\r\n  public async sendEmail(templateName : string, recipient : Recipient ) : Promise<void> {\r\n    console.log(\"In EmailService.sendEmail with templateName:\", templateName, \"and recipient:\", recipient);\r\n\r\n    recipient.username = process.env.NODEMAILER_USERNAME;\r\n    recipient.logoUrl = this.emailContext.getLogoUrl();\r\n    recipient.company = this.emailContext.getCompany();\r\n    recipient.year = this.emailContext.getYear();\r\n\r\n    await loadTemplate(templateName, recipient)\r\n    .then((result: any) => {\r\n        const mail : Mail = {\r\n            to: result.recipient.email ,\r\n            from: recipient.company as string,\r\n            subject: result.email.subject,\r\n            html: result.email.html,\r\n            text: result.email.text,            \r\n        }    \r\n        if(!recipient.email || recipient.email == undefined){\r\n            throw new Error(\"email is required!!\")\r\n        }\r\n        transportMail(mail)\r\n        .then(()=>{\r\n            console.log(\"sent!!\")\r\n        })\r\n        .catch((error :any )=>{\r\n            console.log(\"error in transportMail:\", error);\r\n            return error\r\n        } )    \r\n\r\n    })\r\n    .catch((error: unknown)=>{\r\n        return error\r\n    })    \r\n  \r\n  }\r\n}    \r\n\r\nexport default EmailService;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * \r\n\r\n   .then((user: IUser)=>{\r\n \r\n     let recipient : Recipient= {username : user.username, email: user.email, company : company}  \r\n try{  \r\n    sendEmail('register-account', recipient);\r\n    //TODO ADD PHONE SENDING\r\n   //  sendSms(\"YOUR TWILIO PHONE NUMBER\",recipient)\r\n   console.log(`User created ${JSON.stringify(user)}`);\r\n   if (user) {\r\n     //send response \r\n     res.status(201).json(user);\r\n   }else{\r\n     res.status(400).json({ message: \"something went wrong\" });\r\n   }\r\n \r\n }catch(e){\r\n   console.log(e)\r\n */"],"version":3}