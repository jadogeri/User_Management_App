{"file":"C:\\Users\\Joseph\\Desktop\\Source\\User_Management_App\\app\\server\\src\\controllers\\auth.controller.ts","mappings":"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","names":[],"sources":["C:\\Users\\Joseph\\Desktop\\Source\\User_Management_App\\app\\server\\src\\controllers\\auth.controller.ts"],"sourcesContent":["\r\nimport { Request, Controller as BaseController, Body, Delete, Get, Post, Put, Route, Tags, Response, Path, Example, SuccessResponse, Res, TsoaResponse, Security, NoSecurity} from \"tsoa\";\r\nimport { AutoWired, Controller, Middleware } from \"../decorators\";\r\nimport { Request as ExpressRequest,Response as ExpressResponse } from \"express\";\r\n\r\nimport { TYPES } from \"../types/binding.type\";\r\nimport { AuthControllerInterface } from \"../interfaces/auth-controller.interface\";\r\nimport { AuthServiceInterface } from \"../interfaces/auth-service.interface\";\r\nimport loginLimitterMiddleware from \"../middlewares/login-limitter.middleware\";\r\nimport { AuthLoginRequestDTO, AuthRefreshTokenRequestDTO, AuthRegisterRequestDTO } from \"../dtos/requests/auth-request.dto\";\r\nimport { AuthCurrentResponseDTO, AuthLoginResponseDTO, AuthLogoutResponseDTO, AuthRegisterResponseDTO } from \"../dtos/responses/auth-response.dto\";\r\nimport { ErrorResponse } from \"../models/error-response.model\";\r\nimport { loginUserMiddleware } from \"../middlewares/login-user.middleware\";\r\nimport { CredentialValidatorServiceInterface } from \"../interfaces/credential-validator-service.interface\";\r\nimport { ValidationResponse } from \"../models/validation-response.model\";\r\nimport { BadRequestError } from \"../errors/bad-request.error\";\r\nimport { JwtPayloadInterface } from \"../interfaces/jwt-payload.interface\";\r\nimport { Resource, Action } from \"../types/rbac.type\";\r\nimport { RoleNamesEnum } from \"../types/role-names.type\";\r\nimport { UserCreateResponseDTO } from \"../dtos/responses/user-response.dto\";\r\nimport { ConflictError } from \"../errors/conflict.error\";\r\nimport { InternalServerError } from \"../errors/internal-server.error\";\r\nimport { ResourceNotFoundError } from \"../errors/resource-not-found.error\";\r\n\r\n\r\n\r\n@Route(\"auths\")\r\n@Tags(\"Auth\")\r\n@Controller() \r\nexport class AuthController extends BaseController implements AuthControllerInterface {\r\n\r\n  @AutoWired(TYPES.AuthServiceInterface)\r\n  private readonly authService!: AuthServiceInterface;\r\n  @AutoWired(TYPES.CredentialValidatorServiceInterface)\r\n  private readonly credentialValidatorService!: CredentialValidatorServiceInterface;\r\n\r\n\r\n  /**\r\n   * Authenticates a registered user.\r\n   * @summary Authenticates an existing user\r\n   * @param requestBody The user's credentials for authentication.\r\n   * @returns A response containing the authenticated user's refresh and access tokens.\r\n   */\r\n  @SuccessResponse(\"200\", \"ok\")\r\n  @Response<ResourceNotFoundError>(\"404\", \"Resource Not Found\")\r\n  @Response<BadRequestError>(\"400\", \"Bad Request\")\r\n  @Example<AuthLoginResponseDTO>({\r\n    accessToken: \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7InVzZXJuYW1lIjoicm9vdEBBZG1pbmlzdHJhdG9yMSIsImVtYWlsIjoicm9vdEBleGFtcGxlLmNvbSIsImlkIjoxLCJyb2xlcyI6W3siaWQiOjEsIm5hbWUiOiJBRE1JTiIsImRlc2NyaXB0aW9uIjoiQWRtaW5pc3RyYXRvcjogSGlnaGVzdCBsZXZlbDsgbWFuYWdlcyB1c2Vycywgc2V0dGluZ3MsIGFuZCBzeXN0ZW0gYWNjZXNzOyBjYW4gZG8gZXZlcnl0aGluZy4iLCJwZXJtaXNzaW9ucyI6W3siaWQiOjEsImRlc2NyaXB0aW9uIjoiRnVsbCBhY2Nlc3MgdG8gYWxsIHJlc291cmNlcy4iLCJyZXNvdXJjZSI6IioiLCJhY3Rpb24iOiIqIn0seyJpZCI6MiwiZGVzY3JpcHRpb24iOiJDcmVhdGUgbmV3IHVzZXIuIiwicmVzb3VyY2UiOiJ1c2VyIiwiYWN0aW9uIjoiY3JlYXRlIn0seyJpZCI6MywiZGVzY3JpcHRpb24iOiJSZWFkIG93biBkYXRhLiIsInJlc291cmNlIjoidXNlciIsImFjdGlvbiI6InJlYWQifSx7ImlkIjo0LCJkZXNjcmlwdGlvbiI6IlVwZGF0ZSBvd24gZGF0YS4iLCJyZXNvdXJjZSI6InVzZXIiLCJhY3Rpb24iOiJ1cGRhdGUifSx7ImlkIjo1LCJkZXNjcmlwdGlvbiI6IkRlbGV0ZSBvd24gcmVjb3JkLiIsInJlc291cmNlIjoidXNlciIsImFjdGlvbiI6ImRlbGV0ZSJ9LHsiaWQiOjksImRlc2NyaXB0aW9uIjoiUmVhZCBvd24gYXV0aCBkYXRhLiIsInJlc291cmNlIjoiYXV0aCIsImFjdGlvbiI6InJlYWQifSx7ImlkIjoxMCwiZGVzY3JpcHRpb24iOiJVcGRhdGUgb3duIGF1dGggZGF0YS4iLCJyZXNvdXJjZSI6ImF1dGgiLCJhY3Rpb24iOiJ1cGRhdGUifSx7ImlkIjoxMSwiZGVzY3JpcHRpb24iOiJDcmVhdGUgYXV0aCBkYXRhLiIsInJlc291cmNlIjoiYXV0aCIsImFjdGlvbiI6ImNyZWF0ZSJ9XX1dfSwic2NvcGVzIjpbIio6KiIsInVzZXI6Y3JlYXRlIiwidXNlcjpyZWFkIiwidXNlcjp1cGRhdGUiLCJ1c2VyOmRlbGV0ZSIsImF1dGg6cmVhZCIsImF1dGg6dXBkYXRlIiwiYXV0aDpjcmVhdGUiXSwiaWF0IjoxNzY3NjcwMzE0LCJleHAiOjE3NjgyNzUxMTR9.PCFsmtyNL1uFauuvfD38KTu927LjpzQDTQVJvC05ZM2\",\r\n    refreshToken: \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7InVzZXJuYW1lIjoicm9vdEBBZG1pbmlzdHJhdG9yMSIsImVtYWlsIjoicm9vdEBleGFtcGxlLmNvbSIsImlkIjoxLCJyb2xlcyI6W3siaWQiOjEsIm5hbWUiOiJBRE1JTiIsImRlc2NyaXB0aW9uIjoiQWRtaW5pc3RyYXRvcjogSGlnaGVzdCBsZXZlbDsgbWFuYWdlcyB1c2Vycywgc2V0dGluZ3MsIGFuZCBzeXN0ZW0gYWNjZXNzOyBjYW4gZG8gZXZlcnl0aGluZy4iLCJwZXJtaXNzaW9ucyI6W3siaWQiOjEsImRlc2NyaXB0aW9uIjoiRnVsbCBhY2Nlc3MgdG8gYWxsIHJlc291cmNlcy4iLCJyZXNvdXJjZSI6IioiLCJhY3Rpb24iOiIqIn0seyJpZCI6MiwiZGVzY3JpcHRpb24iOiJDcmVhdGUgbmV3IHVzZXIuIiwicmVzb3VyY2UiOiJ1c2VyIiwiYWN0aW9uIjoiY3JlYXRlIn0seyJpZCI6MywiZGVzY3JpcHRpb24iOiJSZWFkIG93biBkYXRhLiIsInJlc291cmNlIjoidXNlciIsImFjdGlvbiI6InJlYWQifSx7ImlkIjo0LCJkZXNjcmlwdGlvbiI6IlVwZGF0ZSBvd24gZGF0YS4iLCJyZXNvdXJjZSI6InVzZXIiLCJhY3Rpb24iOiJ1cGRhdGUifSx7ImlkIjo1LCJkZXNjcmlwdGlvbiI6IkRlbGV0ZSBvd24gcmVjb3JkLiIsInJlc291cmNlIjoidXNlciIsImFjdGlvbiI6ImRlbGV0ZSJ9LHsiaWQiOjksImRlc2NyaXB0aW9uIjoiUmVhZCBvd24gYXV0aCBkYXRhLiIsInJlc291cmNlIjoiYXV0aCIsImFjdGlvbiI6InJlYWQifSx7ImlkIjoxMCwiZGVzY3JpcHRpb24iOiJVcGRhdGUgb3duIGF1dGggZGF0YS4iLCJyZXNvdXJjZSI6ImF1dGgiLCJhY3Rpb24iOiJ1cGRhdGUifSx7ImlkIjoxMSwiZGVzY3JpcHRpb24iOiJDcmVhdGUgYXV0aCBkYXRhLiIsInJlc291cmNlIjoiYXV0aCIsImFjdGlvbiI6ImNyZWF0ZSJ9XX1dfSwic2NvcGVzIjpbIio6KiIsInVzZXI6Y3JlYXRlIiwidXNlcjpyZWFkIiwidXNlcjp1cGRhdGUiLCJ1c2VyOmRlbGV0ZSIsImF1dGg6cmVhZCIsImF1dGg6dXBkYXRlIiwiYXV0aDpjcmVhdGUiXSwiaWF0IjoxNzY3NjcwMzE0LCJleHAiOjE3NjgyNzUxMTR9.eLK-wWRy2D1DOxEjyFw_K4XMlS57kNXNeCgRy6GZ8J7\"\r\n  })  \r\n  @Middleware(loginUserMiddleware(\"\",[\"user:read\"]))\r\n  @Post(\"/login\")\r\n  public async loginUser(@Body() userRequest: AuthLoginRequestDTO, @Request() req: ExpressRequest): Promise<AuthLoginResponseDTO | ErrorResponse> {\r\n\r\n    console.log(\"In login controller with request: \", userRequest); \r\n    // calling validation service\r\n    const validation : ValidationResponse = this.credentialValidatorService.validateLogin(userRequest);\r\n    if(!validation.isValid()){\r\n      const errorResponse : ErrorResponse = validation.getErrorResponse() as ErrorResponse;\r\n      return errorResponse;\r\n    }\r\n    //calling service\r\n    const userResponse : ErrorResponse | AuthLoginResponseDTO = await this.authService.login(userRequest, req);  \r\n    \r\n    if(userResponse instanceof ErrorResponse){\r\n      return userResponse;\r\n    }\r\n    return userResponse;\r\n  }\r\n  \r\n  @Security(\"jwt\",[\"auth:delete\"])\r\n  @Post(\"/logout\")\r\n  public async logoutUser(@Request() req: ExpressRequest): Promise<AuthLogoutResponseDTO> {\r\n    const payload : JwtPayloadInterface= req.payload;\r\n    console.log(\"Current user payload in controller: \", payload);\r\n    const response = await this.authService.logout(payload);\r\n    return response;\r\n  }\r\n  @Post(\"/forgot-password\")\r\n  public async forgotUser(): Promise<any> {\r\n    return this.authService.forgot();\r\n  }\r\n  @Post(\"/reset-password\") \r\n  public async resetUser(): Promise<any> {\r\n    return this.authService.reset();\r\n  }\r\n\r\n  /**\r\n     * Creates a new user in the system.\r\n     * @summary Create a new user\r\n     * @param requestBody The user details for creation.\r\n     * @returns The newly created user.\r\n     */\r\n    @NoSecurity()\r\n    @SuccessResponse(\"201\", \"Created\")\r\n    @Response<ErrorResponse>(\"404\", \"Not Found\")\r\n    @Response<ConflictError>(\"409\", \"Conflict\")\r\n    @Response<InternalServerError>(\"500\", \"Internal Server Error\")\r\n    @Response<ResourceNotFoundError>(\"404\", \"Resource Not Found\")\r\n    @Response<BadRequestError>(\"400\", \"Bad Request\")\r\n    @Example<UserCreateResponseDTO>({\r\n      id: 1,\r\n      username: \"john1doe\",\r\n      fullname: \"John Doe\",\r\n      email: \"johndoe@tsoa.com\",\r\n      phone: \"123-456-7890\",\r\n      createdAt: new Date(\"2023-01-01T10:00:00Z\"),\r\n      updatedAt: new Date(\"2023-01-01T11:30:00Z\"),\r\n      failedLogins: 0,\r\n      isEnabled: false\r\n    })  \r\n    @Post(\"/register\")   \r\n    public async registerUser( @Body() requestBody: AuthRegisterRequestDTO): Promise<AuthRegisterResponseDTO |  ErrorResponse> {\r\n  \r\n      const userRequest : AuthRegisterRequestDTO = requestBody\r\n      // calling validation service\r\n      const validation : ValidationResponse = this.credentialValidatorService.validateRegistration(userRequest);\r\n      if(!validation.isValid()){\r\n        console.log(\"validation failed in controller\", validation.getErrorResponse()?.getMessage());\r\n        const errorResponse : ErrorResponse = validation.getErrorResponse() as ErrorResponse;\r\n        this.setStatus(errorResponse.getCode());\r\n        return errorResponse;\r\n      }   \r\n      //calling user service\r\n      const userResponse : ErrorResponse | AuthRegisterResponseDTO = await this.authService.register(userRequest);    \r\n  \r\n      return userResponse;\r\n  \r\n    }\r\n  \r\n\r\n  /**\r\n   * Creates a new refresh token in the system.\r\n   * @summary Invalidate current refresh token and generate a new pair of tokens\r\n   * @param requestBody The current refresh token.\r\n   * @returns The newly created refresh and access tokens.\r\n   */\r\n\r\n   @Post(\"/refresh\")\r\n  public async refreshToken(@Body() userRequest: AuthRefreshTokenRequestDTO, @Request() req: ExpressRequest): Promise<any> {\r\n    const { refreshToken } = userRequest;\r\n    console.log(\"In refresh token controller with refreshToken: \", refreshToken); \r\n    if(!refreshToken || refreshToken.trim() === \"\"){ \r\n      throw new BadRequestError(\"Refresh token is required\");\r\n    }\r\n\r\n    return this.authService.refresh(refreshToken, req);\r\n  }\r\n\r\n  \r\n      /**\r\n     * Gets current user credentials by access token.\r\n     * @summary Gets authorized user jwt payload\r\n     * @returns The current user's JWT payload.\r\n     */\r\n    @SuccessResponse(\"200\", \"OK\")\r\n    @Security(\"jwt\", [\"user:read\"])\r\n    @Example<AuthCurrentResponseDTO>({\r\n    user: {\r\n      username: \"John1Doe\",\r\n      email: \"JohnDoe@gmail.com\",\r\n      id: 2,\r\n      roles: [\r\n        {\r\n          id: 2,\r\n          users:[],\r\n          name: RoleNamesEnum.USER,\r\n          description: \"Regular User: Standard access; can use application features but has limited administrative capabilities.\",\r\n          permissions: [\r\n            {\r\n              id: 2,\r\n              description: \"Create new user.\",\r\n              resource: Resource.USER,\r\n              action: Action.CREATE,\r\n              roles:[],\r\n              rbacPermission:() => 'user:create',\r\n            },\r\n            {\r\n              id: 3,\r\n              description: \"Read own data.\",\r\n              resource : Resource.USER,\r\n              action: Action.READ,\r\n              roles:[],\r\n              rbacPermission:() => 'user:read', \r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    },\r\n    \"scopes\": [\r\n      \"user:create\",\r\n      \"user:read\",\r\n    ],\r\n    \"iat\": 1767492049,\r\n    \"exp\": 1767492109\r\n  }) \r\n    @Get(\"/current\")\r\n    public async currentUser(@Request() req: ExpressRequest): Promise<JwtPayloadInterface> {\r\n      const payload : JwtPayloadInterface= req.payload;\r\n      console.log(\"Current user payload in controller: \", payload);\r\n      return payload;\r\n    }\r\n  @Get(\"/\")\r\n  public async getUsers(\r\n    // TSOA's @Request() decorator injects the Express request object\r\n    @Request() req: Request ,\r\n    // Note: TSOA automatically provides 'res' if you use the\r\n    // the name 'res' as a parameter within the method signature.\r\n    @Res() res: TsoaResponse<200, any>\r\n  ): Promise<any> {\r\n      // const users = await this.userService.findAll();\r\n      // Placeholder for your actual logic\r\n      const users = [{ id: 1, name: \"Alice\" }, { id: 2, name: \"Bob\" }];\r\n\r\n      // Manually send the JSON response\r\n      return res(200, users);\r\n\r\n  }\r\n    \r\n}\r\n\r\n\r\n\r\n"],"version":3}